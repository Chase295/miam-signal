# IoT Orchestrator Signal Device Client

Python-Client f√ºr das IoT Orchestrator System mit Signal-Messaging-Integration. Dieser Client erm√∂glicht es, Signal-Nachrichten √ºber WebSocket zu empfangen und an den IoT Orchestrator weiterzuleiten sowie TXT Output vom IoT Orchestrator √ºber die Signal REST API zu versenden.

**üê≥ Docker Image verf√ºgbar auf Docker Hub:** [chase295/miam-signal](https://hub.docker.com/r/chase295/miam-signal)

## üìã Features

- ‚úÖ **Signal-Integration**: Empfang und Versand von Signal-Nachrichten
- ‚úÖ **IoT Orchestrator Anbindung**: Automatische Weiterleitung von Nachrichten
- ‚úÖ **WebSocket Support**: Echtzeit-Kommunikation √ºber WebSocket
- ‚úÖ **Docker-ready**: Vollst√§ndig containerisiert und produktionsbereit
- ‚úÖ **Multi-Architecture**: Unterst√ºtzt `linux/amd64` und `linux/arm64`
- ‚úÖ **Konfigurierbar**: Alle Einstellungen √ºber Umgebungsvariablen
- ‚úÖ **Einfache Installation**: Einfach `docker-compose up` - kein Build n√∂tig!
- ‚úÖ **Automatische Reconnection**: Automatische Wiederverbindung bei Verbindungsabbr√ºchen
- ‚úÖ **Streaming Support**: Unterst√ºtzt gestreamte TXT Outputs vom IoT Orchestrator

## üìÅ Projektstruktur

```
miam-signal/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ device-signal.py    # Haupt-Python-Skript
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose Konfiguration
‚îú‚îÄ‚îÄ Dockerfile              # Docker Image Definition
‚îú‚îÄ‚îÄ requirements.txt        # Python Abh√§ngigkeiten
‚îî‚îÄ‚îÄ README.md              # Diese Datei
```

## üöÄ Schnellstart (Installation in 2 Minuten)

### Voraussetzungen

- **Docker** und **Docker Compose** installiert ([Installationsanleitung](https://docs.docker.com/get-docker/))
- Zugriff auf IoT Orchestrator WebSocket-Gateway
- Zugriff auf Signal-Server (WebSocket und REST API)

### Installation

#### Schritt 1: Repository klonen oder docker-compose.yml herunterladen

```bash
# Option 1: Repository klonen
git clone https://github.com/Chase295/miam-signal.git
cd miam-signal

# Option 2: Nur docker-compose.yml herunterladen
wget https://raw.githubusercontent.com/Chase295/miam-signal/main/docker-compose.yml
```

#### Schritt 2: Konfiguration anpassen

√ñffne `docker-compose.yml` und passe die Umgebungsvariablen an:

```yaml
environment:
  # IoT Orchestrator (BITTE ANPASSEN!)
  WS_HOST: "10.0.3.17"                        # IoT Orchestrator Host
  WS_PORT: 8080                                 # WebSocket Gateway Port
  WS_PATH: "/ws/external"                     # WebSocket Path
  DEVICE_NAME: "signal-device"                # Name des Ger√§tes
  SIMPLE_API_KEY: "BITTE-DEIN-API-KEY-EINFUEGEN" # ‚ö†Ô∏è WICHTIG: API-KEY eintragen!

  # Signal-Konfiguration (BITTE ANPASSEN!)
  SIGNAL_SERVER_URL: "signal.local.chase295.de"  # Signal-Server URL
  SIGNAL_RECEIVE_NUMBER: "+4915122215051"         # Eigene Signal-Nummer (Empfang)
  SIGNAL_SEND_NUMBER: "+4915122215051"           # Eigene Signal-Nummer (Versand)
  SIGNAL_RECIPIENT_NUMBER: "+4917681328005"      # Standard-Empf√§nger
  SIGNAL_VERIFY_SSL: "False"                      # SSL-Verifizierung (True/False)
```

**‚ö†Ô∏è Wichtig:** Passe mindestens die folgenden Werte an:
- `SIMPLE_API_KEY` - Dein IoT Orchestrator API-Key
- `WS_HOST` - Die IP-Adresse oder Domain deines IoT Orchestrators
- `SIGNAL_SERVER_URL` - Die URL deines Signal-Servers
- `SIGNAL_RECEIVE_NUMBER`, `SIGNAL_SEND_NUMBER`, `SIGNAL_RECIPIENT_NUMBER` - Deine Signal-Nummern

#### Schritt 3: Container starten

```bash
# Container starten (l√§dt automatisch das Image von Docker Hub)
docker-compose up -d

# Logs anzeigen (um zu sehen, ob alles funktioniert)
docker-compose logs -f signal-client

# Container stoppen
docker-compose down
```

**üéâ Fertig!** Das Image wird automatisch von Docker Hub geladen - kein Build erforderlich!

### Verf√ºgbare Docker Images

- **Latest Version**: `chase295/miam-signal:latest`
- **Stabile Version**: `chase295/miam-signal:v1.0.0`

Das Image ist √∂ffentlich auf [Docker Hub](https://hub.docker.com/r/chase295/miam-signal) verf√ºgbar.

### Multi-Architecture Support

Das Docker Image unterst√ºtzt mehrere Plattformen:
- **linux/amd64** - F√ºr Intel/AMD Server und Desktop
- **linux/arm64** - F√ºr ARM64 Server (z.B. AWS Graviton, Apple Silicon)

Docker w√§hlt automatisch das passende Image f√ºr deine Plattform beim Pull.

## üîß Konfiguration

### Umgebungsvariablen

Alle Konfigurationswerte werden √ºber Umgebungsvariablen gesteuert:

| Variable | Beschreibung | Standard |
|----------|-------------|----------|
| `WS_HOST` | IoT Orchestrator Host-Adresse | `10.0.3.17` |
| `WS_PORT` | WebSocket Gateway Port | `8080` |
| `WS_PATH` | WebSocket Pfad | `/ws/external` |
| `DEVICE_NAME` | Name des Ger√§tes | `signal-device` |
| `SIMPLE_API_KEY` | API-Key f√ºr Authentifizierung | `default-api-key-123` |
| `SIGNAL_SERVER_URL` | Signal-Server URL (ohne https://) | `signal.local.chase295.de` |
| `SIGNAL_RECEIVE_NUMBER` | Eigene Signal-Nummer (Empfang) | `+4915122215051` |
| `SIGNAL_SEND_NUMBER` | Eigene Signal-Nummer (Versand) | `+4915122215051` |
| `SIGNAL_RECIPIENT_NUMBER` | Standard-Empf√§ngernummer | `+4917681328005` |
| `SIGNAL_VERIFY_SSL` | SSL-Zertifikat-Verifizierung | `False` |

### SSL-Konfiguration

Standardm√§√üig ist die SSL-Verifizierung deaktiviert (`SIGNAL_VERIFY_SSL: "False"`). F√ºr Produktionsumgebungen mit g√ºltigen Zertifikaten sollte dies auf `"True"` gesetzt werden.

## üê≥ Docker

### Image direkt von Docker Hub verwenden (Empfohlen)

Die `docker-compose.yml` ist so konfiguriert, dass das Image automatisch von Docker Hub geladen wird. **Kein Build n√∂tig!**

```bash
# Starten (l√§dt Image automatisch von Docker Hub)
docker-compose up -d

# Image manuell pullen
docker pull chase295/miam-signal:latest
```

### Eigenes Image bauen (Optional)

Falls du das Image selbst bauen m√∂chtest (z.B. f√ºr Entwicklung):

```bash
docker-compose build
```

Oder manuell:

```bash
docker build -t chase295/miam-signal:latest .
```

### Container verwalten

```bash
# Starten
docker-compose up -d

# Stoppen
docker-compose down

# Neustarten
docker-compose restart signal-client

# Logs anzeigen
docker-compose logs -f signal-client

# Status pr√ºfen
docker-compose ps
```

## üì° Funktionsweise

### Signal ‚Üí IoT Orchestrator (txt_input)

1. Das Ger√§t empf√§ngt Signal-Nachrichten √ºber WebSocket (`wss://signal-server/v1/receive/{number}`)
2. Empfangene Nachrichten werden an den IoT Orchestrator weitergeleitet
3. Das Ger√§t ist als `txt_input` Device im IoT Orchestrator verf√ºgbar

### IoT Orchestrator ‚Üí Signal (txt_output)

1. Der IoT Orchestrator sendet TXT Output an das Ger√§t
2. Das Ger√§t versendet die Nachricht √ºber die Signal REST API (`https://signal-server/v2/send`)
3. Das Ger√§t ist als `txt_output` Device im IoT Orchestrator verf√ºgbar

## üõ†Ô∏è Entwicklung

### Lokal ohne Docker

```bash
# Abh√§ngigkeiten installieren
pip install -r requirements.txt

# Umgebungsvariablen setzen (optional, falls nicht in docker-compose.yml)
export WS_HOST="10.0.3.17"
export WS_PORT="8080"
export SIMPLE_API_KEY="dein-api-key"
# ... weitere Variablen

# Script ausf√ºhren
python3 app/device-signal.py
```

### Abh√§ngigkeiten

- `websockets` - WebSocket Client/Server Library
- `httpx` - Asynchroner HTTP Client f√ºr Signal REST API

## üìù Troubleshooting

### Verbindungsprobleme

**Problem**: Container startet nicht oder verbindet sich nicht

**L√∂sung**:
- √úberpr√ºfe die Logs: `docker-compose logs -f signal-client`
- Stelle sicher, dass `SIMPLE_API_KEY` korrekt gesetzt ist
- √úberpr√ºfe Netzwerkverbindung zu `WS_HOST:WS_PORT`
- Stelle sicher, dass der Signal-Server erreichbar ist
- Teste die Verbindung manuell: `ping {WS_HOST}` oder `curl http://{WS_HOST}:8080`

**Problem**: "no matching manifest for linux/amd64"

**L√∂sung**:
- Das Image wurde mit Multi-Architecture Support aktualisiert
- F√ºhre `docker-compose pull` aus, um das neueste Multi-Arch Image zu laden
- Oder verwende explizit: `docker pull chase295/miam-signal:latest`

### SSL-Fehler

**Problem**: SSL-Zertifikat-Fehler beim Verbinden zum Signal-Server

**L√∂sung**:
- Setze `SIGNAL_VERIFY_SSL: "False"` in `docker-compose.yml` (f√ºr selbst-signierte Zertifikate)
- Oder stelle sicher, dass g√ºltige Zertifikate verwendet werden
- F√ºr Produktionsumgebungen: Verwende ein g√ºltiges SSL-Zertifikat und setze `SIGNAL_VERIFY_SSL: "True"`

### Device-Registrierung

**Problem**: Device wird nicht im IoT Orchestrator registriert

**L√∂sung**:
- √úberpr√ºfe ob `client_secret_{DEVICE_NAME}` in der Datenbank gespeichert ist
- Stelle sicher, dass die REST API erreichbar ist (`http://{WS_HOST}:3000/api/devices`)
- √úberpr√ºfe die Logs auf Registrierungsfehler
- Stelle sicher, dass `DEVICE_NAME` und `SIMPLE_API_KEY` korrekt gesetzt sind

### Container beendet sich sofort (Exit Code 137)

**Problem**: Container wird nach kurzer Zeit beendet

**L√∂sung**:
- √úberpr√ºfe die Logs auf Fehlermeldungen: `docker-compose logs signal-client`
- Stelle sicher, dass alle Umgebungsvariablen korrekt gesetzt sind
- √úberpr√ºfe die Docker-Ressourcen (Speicher, CPU)
- Exit Code 137 deutet oft auf OOM (Out of Memory) hin

### Keine Signal-Nachrichten werden empfangen

**Problem**: Signal-Nachrichten kommen nicht an

**L√∂sung**:
- √úberpr√ºfe, ob die Signal-Nummer korrekt registriert ist
- Stelle sicher, dass `SIGNAL_RECEIVE_NUMBER` korrekt formatiert ist (z.B. `+4915122215051`)
- √úberpr√ºfe die Signal WebSocket-URL in den Logs
- Teste die Signal-Server-Erreichbarkeit

## üîó Links

- **GitHub Repository**: https://github.com/Chase295/miam-signal
- **Docker Hub**: https://hub.docker.com/r/chase295/miam-signal
- **Docker Image**: `chase295/miam-signal:latest`
- **Releases**: https://github.com/Chase295/miam-signal/releases

## üîÑ Updates und Versionierung

### Image aktualisieren

```bash
# Neueste Version pullen
docker-compose pull

# Container neu starten mit neuer Version
docker-compose up -d
```

### Versionierte Tags verwenden

F√ºr produktive Umgebungen empfehlen wir, spezifische Versionen zu verwenden:

```yaml
services:
  signal-client:
    image: chase295/miam-signal:v1.0.0  # Stabile Version
    # statt: image: chase295/miam-signal:latest
```

### Verf√ºgbare Versionen

- `latest` - Neueste Entwicklungsversion
- `v1.0.0` - Stabile Release-Version

## üìä Monitoring und Health Checks

### Container-Status pr√ºfen

```bash
# Status anzeigen
docker-compose ps

# Logs in Echtzeit verfolgen
docker-compose logs -f signal-client

# Ressourcenverbrauch √ºberwachen
docker stats miam-signal-signal-client-1
```

### Log-Analyse

```bash
# Letzte 100 Zeilen
docker-compose logs --tail=100 signal-client

# Fehler filtern
docker-compose logs signal-client | grep -i error

# Zeitstempel anzeigen
docker-compose logs -t signal-client
```

## üîí Sicherheitshinweise

### Best Practices

1. **API-Keys sch√ºtzen**: Speichere `SIMPLE_API_KEY` niemals in Version-Control
2. **Umgebungsvariablen**: Verwende `.env` Dateien f√ºr sensible Daten (nicht in git)
3. **SSL-Verifizierung**: In Produktion `SIGNAL_VERIFY_SSL: "True"` verwenden
4. **Netzwerk-Isolation**: Nutze Docker-Netzwerke f√ºr Container-Isolation
5. **Regelm√§√üige Updates**: Halte das Image aktuell mit `docker-compose pull`

### .env Datei verwenden

Erstelle eine `.env` Datei f√ºr sensible Daten:

```bash
# .env Datei (nicht committen!)
SIMPLE_API_KEY=dein-geheimer-api-key
WS_HOST=10.0.3.17
```

Und verwende sie in `docker-compose.yml`:

```yaml
environment:
  SIMPLE_API_KEY: ${SIMPLE_API_KEY}
  WS_HOST: ${WS_HOST}
```

## üí° Use Cases und Beispiele

### Beispiel 1: Einfache Nachrichtenweiterleitung

Einrichtung eines Ger√§ts, das alle eingehenden Signal-Nachrichten an den IoT Orchestrator weiterleitet:

```yaml
environment:
  DEVICE_NAME: "signal-bridge"
  SIGNAL_RECEIVE_NUMBER: "+4915122215051"
```

### Beispiel 2: Mehrere Ger√§te mit verschiedenen Nummern

Mehrere Container mit verschiedenen Signal-Nummern:

```yaml
services:
  signal-client-1:
    image: chase295/miam-signal:latest
    environment:
      DEVICE_NAME: "signal-device-1"
      SIGNAL_RECEIVE_NUMBER: "+4915122215051"
      # ...
  
  signal-client-2:
    image: chase295/miam-signal:latest
    environment:
      DEVICE_NAME: "signal-device-2"
      SIGNAL_RECEIVE_NUMBER: "+4915122215052"
      # ...
```

### Beispiel 3: Produktions-Setup mit spezifischer Version

```yaml
services:
  signal-client:
    image: chase295/miam-signal:v1.0.0  # Stabile Version
    restart: always  # Automatischer Neustart
    environment:
      # ... Konfiguration
```

## ‚ùì H√§ufig gestellte Fragen (FAQ)

### Q: Kann ich das Image selbst bauen?

**A:** Ja! Verwende `docker-compose build` oder `docker build -t chase295/miam-signal .`

### Q: Unterst√ºtzt das Image ARM64 Server?

**A:** Ja! Das Image wurde mit Multi-Architecture Support gebaut und unterst√ºtzt sowohl `linux/amd64` als auch `linux/arm64`.

### Q: Wie starte ich das Ger√§t automatisch beim Boot?

**A:** Verwende `restart: always` oder `restart: unless-stopped` in der `docker-compose.yml`. Oder richte einen systemd Service ein.

### Q: Kann ich mehrere Signal-Nummern mit einem Container verwenden?

**A:** Nein, jeder Container verwendet eine Signal-Nummer. F√ºr mehrere Nummern starte mehrere Container mit verschiedenen `DEVICE_NAME` und `SIGNAL_RECEIVE_NUMBER`.

### Q: Wie teste ich die Verbindung?

**A:** √úberpr√ºfe die Logs: `docker-compose logs -f signal-client`. Du solltest sehen:
- ‚úì IoT Orchestrator Verbindung hergestellt
- ‚úì Signal WebSocket verbunden

### Q: Was bedeutet Exit Code 137?

**A:** Exit Code 137 bedeutet, dass der Container vom System beendet wurde (SIGKILL), oft wegen Speichermangels oder manueller Beendigung.

### Q: Wie aktualisiere ich auf eine neue Version?

**A:** 
```bash
docker-compose pull
docker-compose up -d
```

## üèóÔ∏è Architektur

### System-√úbersicht

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Signal Server ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ Signal Device‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ IoT Orchestrator‚îÇ
‚îÇ  (WebSocket)   ‚îÇ         ‚îÇ   (Client)   ‚îÇ         ‚îÇ  (WebSocket)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚îÇ
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ  Signal REST API   ‚îÇ
                            ‚îÇ   (Nachrichten     ‚îÇ
                            ‚îÇ    versenden)      ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Datenfluss

1. **Signal ‚Üí IoT Orchestrator (txt_input)**
   - Signal-Nachricht wird √ºber WebSocket empfangen
   - Wird an IoT Orchestrator als txt_input weitergeleitet
   - Metadata enth√§lt Absender-Informationen

2. **IoT Orchestrator ‚Üí Signal (txt_output)**
   - IoT Orchestrator sendet TXT Output
   - Client sendet √ºber Signal REST API
   - Unterst√ºtzt Streaming von langen Nachrichten

## üìö Weitere Ressourcen

### Dokumentation

- [Docker Compose Dokumentation](https://docs.docker.com/compose/)
- [WebSocket Protocol](https://datatracker.ietf.org/doc/html/rfc6455)
- [Signal REST API](https://github.com/AsamK/signal-cli/wiki/REST-API)

### √Ñhnliche Projekte

- [IoT Orchestrator](https://github.com/Chase295) - Hauptprojekt
- Weitere Signal-Integrationen

## üìÑ Lizenz

Dieses Projekt ist Teil des IoT Orchestrator Systems.

## ü§ù Support

Bei Fragen oder Problemen bitte ein Issue erstellen oder die Dokumentation des IoT Orchestrator Systems konsultieren.

### Community

- **GitHub Issues**: F√ºr Bug-Reports und Feature-Requests
- **Pull Requests**: Beitr√§ge sind willkommen!

### Changelog

#### v1.0.0 (2025-10-31)

- ‚ú® Initial Release
- ‚úÖ Multi-Architecture Support (linux/amd64, linux/arm64)
- ‚úÖ Signal WebSocket Integration
- ‚úÖ IoT Orchestrator WebSocket Integration
- ‚úÖ TXT Input/Output Support
- ‚úÖ Streaming Support f√ºr lange Nachrichten
- ‚úÖ Docker Image auf Docker Hub verf√ºgbar

